<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- Incluir a configuração base do Spring Boot -->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <!-- Definir o diretório onde os arquivos de log serão salvos -->
    <!-- Usa a propriedade do Spring Boot se disponível, senão usa "logs" como padrão -->
    <!-- O caminho relativo será resolvido em relação ao diretório de trabalho (onde o JAR está sendo executado) -->
    <springProperty scope="context" name="LOG_PATH" source="logging.file.path" defaultValue="logs"/>

	<!-- Appender para arquivo com rotação (RollingFileAppender) -->
	<!-- RollingFileAppender garante rotação automática e melhor gerenciamento de logs -->
	<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
	    <!-- Nome do arquivo atual (sem padrão de data, pois o fileNamePattern gerencia a rotação) -->
	    <file>${LOG_PATH}/log.log</file>
	    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
	        <!-- Arquivo de log diário com padrão: log_yyyyMMdd.log -->
	        <!-- O Logback automaticamente rotaciona o arquivo atual para este padrão ao mudar de dia -->
	        <fileNamePattern>${LOG_PATH}/log_%d{yyyyMMdd}.log</fileNamePattern>
	        <!-- Manter logs por 15 dias -->
	        <maxHistory>15</maxHistory>
	        <!-- Tamanho máximo total dos arquivos de log antes de remover os mais antigos -->
	        <totalSizeCap>1GB</totalSizeCap>
	    </rollingPolicy>
	    <encoder>
	        <pattern>%date{yyyy-MM-dd HH:mm:ss.SSS} [%level] %logger{36} - %message%n%xException</pattern>
	        <charset>UTF-8</charset>
	    </encoder>
	</appender>
	  
	<!-- Appender para console COM cores (para debug no terminal) -->
	<appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
	    <encoder>
	        <!-- Pattern com cores: %highlight colore automaticamente por nível -->
	        <!-- ERROR=vermelho, WARN=amarelo, INFO=verde, DEBUG=azul, TRACE=azul claro -->
	        <pattern>%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %highlight(%5p) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %msg%n%wEx</pattern>
	        <charset>UTF-8</charset>
	    </encoder>
	</appender>	

    <!-- Configuração do logger raiz -->
    <root level="INFO">
        <!-- Adicionar ambos appenders: CONSOLE (com cores) e FILE (para arquivo) -->
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </root>
</configuration>
